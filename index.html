<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>זמני פתיחת עסקים בבית אל</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
          body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fbfd;
            padding: 20px;
          }
      
          h1 {
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            color: #1a202c;
          }
        </style>
      </head>

<body>
  <h1>זמני פתיחת עסקים בבית אל</h1>

  <div class="container mb-4">
    <input type="text" id="searchInput" class="form-control" placeholder="חיפוש...">
  </div>

  <div id="dataContainer">
    <p class="loading">Loading data from Google Sheets...</p>
  </div>

  <script>
    const sheetid = '1Dq7KewAsLyP1eT1KI5IHL4wmFlcmCgTDQTaKUlqecLU';
    const spreadsheetUrl = "https://script.google.com/macros/s/AKfycbxcQEBA_nD-yPrC5MLRV_BktCU_-5VeZQx6IMxbz4wgNaWB9cn1IJB_gZTzDJ_7hysijQ/exec";
    let allData = [];

    document.addEventListener('DOMContentLoaded', function () {
      fetchGoogleSheetsData(spreadsheetUrl);

      document.getElementById('searchInput').addEventListener('input', function (e) {
        const filtered = filterData(e.target.value);
        displayData(filtered);
      });
    });

    function fetchGoogleSheetsData(url) {
      fetch(url)
        .then(response => response.json())
        .then(jsonData => {
          allData = jsonData.data;
          displayData(allData);
        })
        .catch(error => {
          document.getElementById('dataContainer').innerHTML =
            `<div class="error">Error loading data: ${error.message}<br>
             Make sure your Google Sheet is published to the web.</div>`;
          console.error('Error fetching data:', error);
        });
    }

    function displayData(data) {
      const container = document.getElementById('dataContainer');
      container.innerHTML = '';

      if (!data || data.length === 0) {
        container.innerHTML = '<p class="loading">No data available.</p>';
        return;
      }

      const table = document.createElement('table');
        table.className = "table table-hover table-bordered table-striped";
      const thead = document.createElement('thead');
      const tbody = document.createElement('tbody');

      const headers = Object.keys(data[0]);
      const headerRow = document.createElement('tr');
      headers.forEach(header => {
        
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      data.forEach(row => {
        const tr = document.createElement('tr');
        headers.forEach(header => {
          const td = document.createElement('td');
          td.textContent = row[header] || '';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      container.appendChild(table);
    }

    function filterData(query) {
      query = query.toLowerCase();
      return allData.filter(row => {
        return Object.values(row).some(value =>
          String(value).toLowerCase().includes(query)
        );
      });
    }

    // Auto-refresh every 5 minutes
    setInterval(() => {
      fetchGoogleSheetsData(spreadsheetUrl);
    }, 5 * 60 * 1000);
  </script>
</body>
</html>
