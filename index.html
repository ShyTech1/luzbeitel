<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Data Table</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>Live Data Table</h2>
    <input type="text" id="search" placeholder="Search..." onkeyup="filterTable()">
    <table id="data-table">
        <thead>
            <tr id="table-head"></tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        const SHEET_ID = "1Dq7KewAsLyP1eT1KI5IHL4wmFlcmCgTDQTaKUlqecLU";
        const SHEET_NAME = "Sheet1";
        const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                
                const rows = json.table.rows;
                const headers = json.table.cols.map(col => col.label).filter(label => label);
                
                renderTable(headers, rows);
            } catch (error) {
                console.error("Error fetching data: ", error);
            }
        }

        function renderTable(headers, rows) {
            const thead = document.getElementById("table-head");
            const tbody = document.getElementById("table-body");
            thead.innerHTML = "";
            tbody.innerHTML = "";

            // Create table headers
            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                thead.appendChild(th);
            });

            // Populate table rows
            rows.forEach(row => {
                const tr = document.createElement("tr");
                row.c.forEach(cell => {
                    const td = document.createElement("td");
                    td.textContent = cell ? cell.v : "";
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function filterTable() {
            const query = document.getElementById("search").value.toLowerCase();
            const rows = document.querySelectorAll("#table-body tr");
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? "" : "none";
            });
        }

        fetchData();
        setInterval(fetchData, 60000); // Refresh every minute
    </script>
</body>
</html>
